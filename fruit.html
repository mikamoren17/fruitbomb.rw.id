<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>fruitbomb.rw.id</title>
  <link rel="stylesheet" href="fruit.css">
  <style>
    .row {
      display: flex;
      justify-content: center;
    }
    .cell {
      width: 60px;
      height: 60px;
      border: 1px solid #888;
      margin: 2px;
      font-size: 32px;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #222;
      color: white;
      cursor: pointer;
      border-radius: 8px;
    }
    .cell.revealed {
      background-color: #444;
    }
    .cell.bomb {
      background-color: crimson;
    }
    .button-container {
      margin-top: 20px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background-color: purple;
      color: white;
    }
    .saldo {
      margin-top: 10px;
      font-size: 24px;
      color: white;
    }
    body {
      background-color: black;
      font-family: sans-serif;
      color: white;
    }
  </style>
</head>
<body>
  <center>
    <script>
      if (localStorage.getItem("started") !== "yes") {
        alert("Kembali kehalaman utama ..?");
        window.location.href = "index.html";
      } else {
        localStorage.removeItem("started");
      }
    </script>

    <header><h1>FRUIT BOMB</h1></header>
    <div class="saldo">Saldo: <span id="saldo">0</span> point</div>
    <p>Buka semua buah untuk memenangkan hadiah, namun waspada ada bom yang bersembunyi.</p>
    <div id="game-board"></div>

    <div class="button-container">
      <button class="btn" onclick="mulaiLagi()">Play again</button>
      <button class="btn" onclick="keHome()">Home</button>
    </div>

    <script>
      const rows = 8, cols = 4, bombCount = 3, diamondCount = 2;
      const buahList = ["üçä", "ü•ù", "üçá", "üçâ", "üçÖ", "üå∂Ô∏è", "üçì"];
      let board = [], opened = 0, gameOver = false;

      function updateSaldo() {
        document.getElementById("saldo").innerText = localStorage.getItem("saldo") || 0;
      }

      function mulaiLagi() {
        let saldo = parseInt(localStorage.getItem("saldo") || "0");
        if (saldo < 2000) {
          alert("Saldo point anda tidak mencukupi, harap isi ulang ..");
          return;
        }
        saldo -= 2000;
        localStorage.setItem("saldo", saldo);
        updateSaldo();
        startGame();
      }

      function keHome() {
        window.location.href = "index.html";
      }

      function startGame() {
        board = [];
        opened = 0;
        gameOver = false;
        const totalCell = rows * cols;
        const totalSafe = totalCell - bombCount - diamondCount;

        // Inisialisasi papan
        for (let r = 0; r < rows; r++) {
          board[r] = [];
          for (let c = 0; c < cols; c++) {
            board[r][c] = { bomb: false, diamond: false, revealed: false };
          }
        }

        // üîß Bom Manual
        const manualBombs = [
          [2, 1],
          [4, 3]
        ];

        // Pasang bom manual
        manualBombs.forEach(([r, c]) => {
          if (board[r] && board[r][c]) {
            board[r][c].bomb = true;
          }
        });

        // Pasang bom random (sisa dari total)
        let placedBomb = manualBombs.length;
        while (placedBomb < bombCount) {
          let r = Math.floor(Math.random() * rows);
          let c = Math.floor(Math.random() * cols);
          if (!board[r][c].bomb) {
            board[r][c].bomb = true;
            placedBomb++;
          }
        }

        // Pasang üíé
        let placedDiamond = 0;
        while (placedDiamond < diamondCount) {
          let r = Math.floor(Math.random() * rows);
          let c = Math.floor(Math.random() * cols);
          if (!board[r][c].bomb && !board[r][c].diamond) {
            board[r][c].diamond = true;
            placedDiamond++;
          }
        }

        // Buat board HTML
        const gameBoard = document.getElementById("game-board");
        gameBoard.innerHTML = "";
        for (let r = 0; r < rows; r++) {
          const rowDiv = document.createElement("div");
          rowDiv.className = "row";
          for (let c = 0; c < cols; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.row = r;
            cell.dataset.col = c;
            cell.addEventListener("click", revealCell);
            rowDiv.appendChild(cell);
          }
          gameBoard.appendChild(rowDiv);
        }

        function revealCell() {
          if (gameOver) return;
          const r = +this.dataset.row;
          const c = +this.dataset.col;
          const cellData = board[r][c];
          if (cellData.revealed) return;

          cellData.revealed = true;
          this.classList.add("revealed");

          if (cellData.bomb) {
            this.classList.add("bomb");
            this.textContent = "üí£";
            gameOver = true;
            revealAll();
            alert("Anda kalah ..!");
          } else if (cellData.diamond) {
            this.textContent = "üíé";
            let saldo = parseInt(localStorage.getItem("saldo") || "0");
            saldo += 1500;
            localStorage.setItem("saldo", saldo);
            updateSaldo();
          } else {
            this.textContent = buahList[Math.floor(Math.random() * buahList.length)];
            opened++;
            if (opened === totalSafe) {
              alert("Selamat anda memenangkan 500.000 point ..");
              let saldo = parseInt(localStorage.getItem("saldo") || "0");
              saldo += 500000;
              localStorage.setItem("saldo", saldo);
              updateSaldo();
              gameOver = true;
            }
          }
        }

        function revealAll() {
          document.querySelectorAll(".cell").forEach(cell => {
            const r = +cell.dataset.row;
            const c = +cell.dataset.col;
            const data = board[r][c];
            if (!data.revealed) {
              cell.classList.add("revealed");
              if (data.bomb) {
                cell.classList.add("bomb");
                cell.textContent = "üí£";
              } else if (data.diamond) {
                cell.textContent = "üíé";
              } else {
                cell.textContent = buahList[Math.floor(Math.random() * buahList.length)];
              }
            }
          });
        }
      }

      updateSaldo();
      startGame();
    </script>
  </center>
</body>
</html>
